# 0817





## ì¿ í‚¤ì™€ ì„¸ì…˜

### ì„¸ì…˜ì¿ í‚¤ vs ì¿ í‚¤

#### ì¿ í‚¤

- ì„¸ì…˜ì¿ í‚¤ -> ê·¸ëƒ¥ ì„¸ì…˜
- ìœ ì € ì •ì˜ ì¿ í‚¤ -> ë³´í†µì€ ì´ê±°ë§Œ ì¿ í‚¤ë¼ê³  í•¨



#### ì„¸ì…˜

ì¿ í‚¤ì¸ë° íŠ¹ì •í•œ ë²ˆí˜¸ë¥¼ ê°€ì§€ëŠ” ì¿ í‚¤

ë²ˆí˜¸ëŠ” WASì—ì„œ ë°œí–‰

ê°œë°œìê°€ ë”°ë¡œ ì„¤ì •í•˜ì§€ ì•Šê³  **ìë™ìœ¼ë¡œ ë°œí–‰**ë¨

ë²ˆí˜¸ëŠ” **ì„œë²„ì˜ ì„¸ì…˜ì €ì¥ì†Œì— ë³´ê´€**ë¨ (Map)

**ì‹œê°„ì„ ì§€ì •í•˜ì§€ ì•ŠìŒ**

ex. Tomcat -> *cookie: JSESSOINID = 345678*

ì´ ì„¸ì…˜ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ” ëª…ë ¹ì–´ 

`HttpSession session = request.getSession();`

`setAttribute(key, value)` ìœ¼ë¡œ ì„¤ì •

ì¼ì¢…ì˜ ì„œë²„ê°€ ê°€ì§€ëŠ” ì¶œì…ì¥ë¶€ 



í˜„ì¬ ìš°ë¦¬ê°€ ì‚¬ìš©í•˜ëŠ” ì„¸ì…˜ë°©ì‹ì€ ë³„ë¡œ ì¢‹ì§€ ì•Šì€ ë°©ì‹ -> JSPê°€ ì„¸ì…˜ì„ ê³„ì† ë§Œë“¤ì–´ì„œ



|         ì„¸ì…˜         |                 ì¿ í‚¤ (ì‚¬ìš©ìì •ì˜)                 |
| :------------------: | :-----------------------------------------------: |
|         ìë™         |      ìˆ˜ë™ => **ì§ì ‘** `response.addCookie()`      |
|      ìœ íš¨ê¸°ê°„ X      |           **ìœ íš¨ê¸°ê°„ O** => ë³´ê´€ (íŒŒì¼)           |
| ì •ë³´ë¥¼ ì„œë²„ì—ì„œ ë³´ê´€ | ì¿ í‚¤ ë‚´ì— ì •ë³´ => ìœ„í—˜! -> í•œê¸€XX, ê¸¸ì´.ê°œìˆ˜ ì œí•œ |
|     ê°ì²´ë¡œ ë³´ê´€      |           **ë¬¸ì**ë¡œ ë³´ê´€ => 4kb, 20ê°œ            |
|          `           |                   **ê²½ë¡œì§€ì •**                    |

ì˜›ë‚ ë°©ì‹ -> ì¤‘ìš”ì •ë³´ë¥¼ ì„¸ì…˜ì— ëœì¤‘ìš”ì •ë³´ë¥¼ ì¿ í‚¤ì—







## ì¿ í‚¤ ì„¤ì •í•˜ê¸° - [java cookie api](https://docs.oracle.com/javaee/7/api/javax/servlet/http/Cookie.html)

#### `makeCookie.jsp` ìƒì„±

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Title</title>
</head>
<body>
<%
  					  //Cookie(String name, String value)
    Cookie cookie = new Cookie("sample", "1111");
    response.addCookie(cookie);  // -> Set-Cookie HTTP í—¤ë”ë¡œ ë³€ê²½ê²½
%>
   <h1> ì¿ í‚¤ ë§Œë“¤ì–´ì§ğŸª </h1>
</body>
</html>
```



#### tomcatìœ¼ë¡œ í™•ì¸

<img src="https://user-images.githubusercontent.com/81224398/129647983-8478730e-ef78-4497-8a34-6fbbf7c18ba9.png" alt="image" style="zoom:67%;" />

<img src="https://user-images.githubusercontent.com/81224398/129647689-c8bcac55-9edb-442c-9568-250b56ab74ce.png" alt="image" style="zoom:67%;" />

ì„¤ì •í•œ nameê³¼ valueê°’ì´ cookieë¡œ ì˜ ë„˜ì–´ê°„ ê²ƒ í™•ì¸ ê°€ëŠ¥





- ë‚˜ì¤‘ì— ì¿ í‚¤ ì´ìš©í•´ì„œ í™•ì¸í•œ ìƒí’ˆ ëª©ë¡ë„ ë„ìš°ê¸° ê°€ëŠ¥



### ì¿ í‚¤ì— ê¸°í•œ ì„¤ì •

`makeCookie` ìˆ˜ì •

```jsp
<body>
<%
    Cookie cookie = new Cookie("sample", "1111");
    //ì´ˆ * ë¶„ * ì‹œ
    cookie.setMaxAge(60*60*24); //1 day

    response.addCookie(cookie);  //=> Set-Cookie HTTP í—¤ë”ë¡œ ë³€ê²½ê²½
%>
   <h1> ì¿ í‚¤ ë§Œë“¤ì–´ì§ğŸª </h1>
</body>
```



#### ê²°ê³¼í™•ì¸

![image](https://user-images.githubusercontent.com/81224398/129648042-752261d3-168e-4bba-ae97-0781891694b0.png)

SetCookieì— Max-Age ìƒì„±



*ì°½ì„ ë‹«ê³  ë‹¤ì‹œ í‚¤ë©´ **Sessionê°’ì€ ê³„ì† ë°”ë€Œì§€ë§Œ** ì¿ í‚¤ëŠ” ì„¤ì •í•œ ê¸°í•œê¹Œì§€ëŠ” ê³„ì†í•´ì„œ ì‚´ì•„ìˆê¸°ë•Œë¬¸ì— **ì¿ í‚¤ëŠ” ê³ ì •ê°’ìœ¼ë¡œ ìœ ì§€**ë¨*

ì¦‰ ì¿ í‚¤ì— ì„¤ì •í•´ë‘” ì •ë³´ëŠ” ìœ ì§€ë¨

ì´ê±¸ ì´ìš©í•´ì„œ ë¡œê·¸ì¸ ìœ ì§€ ê°€ëŠ¥ => HOW??



### ì¿ í‚¤ ì´ìš©í•œ ìë™ë¡œê·¸ì¸ 

#### ë¡œê·¸ì¸ ( id,pw ) 

=> ì‚¬ìš©ì ì •ë³´ë¥¼ ì•Œì•„ëƒ„ ( MemberDTO ) => ì¿ í‚¤ìƒì„± => mid ê¸°ë¡ => ìœ íš¨ê¸°ê°„ ì§€ì • ( ex. 1ì¼ ) => ì¿ í‚¤ ì „ì†¡



#### ë¡œê·¸ì¸ ì²´í¬ 

=> ì¿ í‚¤ *ê°’ ( mid )* ì„¤ì •

 midê°€ ìˆë‹¤ë©´ ë¡œê·¸ì¸í•œ ì ì´ ìˆë‹¤ëŠ” ê²ƒ

ì¦‰, mid ì¿ í‚¤ê°€ ì¡´ì¬í•˜ë©´ í˜„ì¬ ë¡œê·¸ì¸í•œ ìƒíƒœë¼ê³  íŒë‹¨

- **mid O** => ì²˜ë¦¬

- **mid X** =>  ë¡œê·¸ì¸ì°½ìœ¼ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸





####  *Remember me*



### ì¿ í‚¤ ì…ë ¥ ì²´í¬ë°•ìŠ¤ ì„¤ì •

ë¡œê·¸ì¸ ì‹œ ì¿ í‚¤ ì²´í¬ë°•ìŠ¤ë¥¼ ë„£ì–´ì„œ ì²´í¬ ì‹œ ì¿ í‚¤ë¥¼ ì„¸íŒ…í•  ìˆ˜ ìˆë„ë¡ (=ìë™ë¡œê·¸ì¸ ì²´í¬ë°•ìŠ¤)



ë¡œê·¸ì¸í›„ í¬ìŠ¤íŠ¸ë°©ì‹ìœ¼ë¡œ ë„˜ì–´ê°



#### `login.jsp` ì— ì²´í¬ë°•ìŠ¤ ìƒì„±

```jsp
    <form action="/login" method="post">
        <input type="text" name="mid">
        <input type="password" name="mpw"><br>
        <input type="checkbox" name="remember">Remember-me
        <button type="submit">LOGIN</button>
    </form>
```



#### `LoginController.java` ì—ì„œ post ìˆ˜ì •

ë¡œê·¸ì¸ í›„ ê°’ì´ ë„˜ì–´ê°€ëŠ” ê²ƒì€ post ë°©ì‹ìœ¼ë¡œ ë„˜ì–´ê°€ê¸°ë•Œë¬¸ì— doPostì—ì„œ ìˆ˜ì •í•´ì¤Œ

```java
protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {

        //íŒŒë¼ë¯¸í„° - mid, mpw
        String mid = request.getParameter("mid");
        String mpw = request.getParameter("mpw");
        String remember = request.getParameter("remember");
        //remember =null ì´ë©´ ì²´í¬X / ê°’ìˆìœ¼ë©´ ì²´í¬O

        try {
            /*...*/
            //remember ê°€ nullê°’ì´ ì•„ë‹ˆê³  ê°’ì„ ë°›ì•„ì™”ì„ë•Œë§Œ(ë¡œê·¸ì¸í–ˆì„ë•Œë§Œ) ì¿ í‚¤ê°’ ì„¤ì •ë˜ë„ë¡
            if (remember != null) {
                //ì¿ í‚¤ìƒì„±
                //ì‚¬ìš©ìì˜ ì•„ì´ë””ë¥¼ value ë¡œ ë‹´ì•„ì¤Œ
                Cookie loginCookie = new Cookie("login", mid);
                loginCookie.setMaxAge(60 * 60 * 24 * 7);  //ê¸°í•œ ì¼ì£¼ì¼ ì§€ì •
                response.addCookie(loginCookie);
            }
            // /msg/list ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œí‚´
            response.sendRedirect("/msg/list");
        } catch(Exception e){/*...*/}
    }
```









#### ê²°ê³¼

![image](https://user-images.githubusercontent.com/81224398/129650191-f40d33e2-029c-47ca-a57c-cc97758e1acc.png)<img src="https://user-images.githubusercontent.com/81224398/129650219-4bafb6df-1ede-4605-91b5-f8fed24478e1.png" alt="image" style="zoom:80%;" />

remember-meë¡œ í‘œí˜„ëœ ì¿ í‚¤ ì²´í¬ë°•ìŠ¤ì— ì²´í¬ë¥¼ í•˜ê³  LOGIN ì„ ëˆŒëŸ¬ ì •ë³´ë¥¼ post ë°©ì‹ìœ¼ë¡œ ë³´ë‚´ë©´ formdataì— ê°’ì´ ë„˜ì–´ê°€ëŠ” ê²ƒì„ ë³¼ ìˆ˜ ìˆìŒ

![image](https://user-images.githubusercontent.com/81224398/129650654-ac5d9c4d-a030-4922-acf5-4529c3f99ae4.png)

ê°’ì´ ì œëŒ€ë¡œ ë„˜ì–´ê°”ë‹¤ë©´ ì²´í¬í–ˆì„ ì‹œ null ê°’ì´ ì•„ë‹ˆë¼ê³  íŒë‹¨í•´ì„œ value ê°€ ì‚¬ìš©ìì˜ ì•„ì´ë””ì¸ midë¡œ ì„¤ì •ëœ ì¿ í‚¤ ìƒì„±ë¨

ê¸°í•œë„ ì œëŒ€ë¡œ ì„¤ì •ëœ ê²ƒì„ ë³¼ ìˆ˜ ìˆìŒ





ì¿ í‚¤ì˜ `MaxAge` ì„¤ì •í•˜ì§€ ì•Šìœ¼ë©´?? => ì‚­ì œë˜ì§€ ì•Šê³  ê³„ì†í•´ì„œ ìŒ“ì—¬ìˆê²Œë¨



ì¿ í‚¤ì— ê¸°í•œì´ ì„¤ì •ë˜ì–´ìˆê¸°ë•Œë¬¸ì— ê·¸ ê¸°ê°„ ë‚´ì—ëŠ” ê³„ì†í•´ì„œ ì‚´ì•„ìˆì„ ê²ƒì´ë€ê±¸ ì•Œ ìˆ˜ ìˆìŒ











### ë¡œê·¸ì¸ ì„¸ì…˜ ë¶„ì„

!!ë‚˜ì¤‘ì— ìŠ¤í”„ë§ ì‹œíë¦¬í‹°ì— ê·¸ëŒ€ë¡œ ë‚˜ì˜´ 

*remember-me*

```java
		//ì„¸ì…˜ë°›ì•„ì˜´
		HttpSession session = request.getSession();
        Object memberObj = session.getAttribute("member");

		//ì¿ í‚¤ë°›ì•„ì˜´
		Cookie[] allCookies = request.getCookies();
        boolean checkCookie = false;

        String user = null;

		//1.
        if (allCookies != null && allCookies.length > 0) {
            for (int i = 0; i < allCookies.length; i++) {
                Cookie ck = allCookies[i];
                //ë¡œê·¸ì¸ í•œ ì ì´ ìˆë‹¤ë©´ ì¿ í‚¤ê°€ ì¡´ì¬í•˜ê²Œë¨
                if (ck.getName().equals("login")) {
                    checkCookie = true;
                    user = ck.getValue();
                }
            }
        }


		//2.
        if (memberObj == null && checkCookie == false) {
            //ë¡œê·¸ì¸í•˜ë¼ê³  ë³´ë‚´ë²„ë¦¬ê¸°
            response.sendRedirect("/login");
            //return != ë°˜í™˜ / ì—¬ê¸°ê¹Œì§€ê°€ ëì´ë‹¤ ëŒ€ì¶©..
            return;
        }


		//3.
        if (memberObj != null) {
            MemberDTO memberDTO = (MemberDTO) memberObj;
            user = memberDTO.getMid();
        }
```



1. #### ì„¸ì…˜X ì¿ í‚¤X

ì„¸ì…˜ì—ì„œ memberObj êº¼ë‚´ì˜¤ì§€ë§Œ ì„¸ì…˜ì´ ì—†ìœ¼ë‹ˆ ì–˜ë„ ì—†ê³   ë°”ë¡œ  í†µê³¼ë¨



2. #### ì„¸ì…˜O ì¿ í‚¤X

memberObj != null ì—ê±¸ë ¤ì„œ ìœ ì € ì¸ì‹ë˜ì–´ ë„˜ê²¨ì§



3. #### ì„¸ì…˜X ì¿ í‚¤O

ìœ„ì—ì„œ allcookies ì²´í¬í•¨ ->  ìœ ì €ê°’ êº¼ë‚´ì˜´



4. #### ì„¸ì…˜O ì¿ í‚¤O

ìœ„ì—ì„œë„ ê±¸ë¦¬ê³  ì•„ë˜ì—ì„œë„ ê±¸ë ¤ì„œ ì•„ë¬´íŠ¼ ìƒê¹€









----

### ì„¤ê³„íë¦„



#### Step1. ë¡œê·¸ì¸ X, í˜ì´ì§•X

*ë“±ë¡ / ìˆ˜ì • / ì‚­ì œ / ì¡°íšŒ / ëª©ë¡*

->**ì™€ì´ì–´í”„ë ˆì„** êµ¬ì„± ( ~ 12:30 )

-> **URL ë¶„ì„ / ì„¤ê³„** ( 12:30 ~ )



#### Step2. ë¡œê·¸ì¸, í˜ì´ì§•











=> ë‚˜ì¤‘ì— ëª©ë¡ì€ ë‹¤ ë³¼ìˆ˜ ìˆì§€ë§Œ ê¸€ ì¡°íšŒëŠ” ë¡œê·¸ì¸ ì •ë³´ ë°›ì•„ì™€ì„œ ê¶Œí•œë”°ë¼ ì°¨ë“±





### URL êµ¬ì„±

|    ê¸°ëŠ¥     |      URL      |    Controller    | GET/POST |            JSP            |        parameter        |  Redirect  |
| :---------: | :-----------: | :--------------: | :------: | :-----------------------: | :---------------------: | :--------: |
| ë“±ë¡ (ì…ë ¥) | /board/write  | WriteController  |   GET    | /WEB-INF/board/write.jsp  |            -            |     -      |
| ë“±ë¡ (ì²˜ë¦¬) | /board/write  | WriteController  |   POST   |                           | title, content,  writer | board/list |
|    ëª©ë¡     |  /board/list  |  ListController  |   GET    |  /WEB-INF/board/list.jsp  |            -            |     -      |
|    ì¡°íšŒ     |  /board/read  |  ReadController  |   GET    |  /WEB-INF/board/read.jsp  |           bno           |     -      |
| ìˆ˜ì • (ì…ë ¥) | /board/modify | ModifyController |   GET    | /WEB-INF/board/modify.jsp |           bno           |     -      |
| ìˆ˜ì • (ì²˜ë¦¬) | /board/modify | ModifyController |   POST   |             -             |   bno, title, content   | board/list |
| ì‚­ì œ (ì²˜ë¦¬) | /board/remove | RemoveController |   POST   |             -             |           bno           | board/list |




































































































































































































































































































































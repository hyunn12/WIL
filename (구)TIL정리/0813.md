# 0813



## Login ë¡œê·¸ì¸



### ì›¹í˜ì´ì§€ì—ì„œ ì„¸ì…˜ / ì¿ í‚¤ í™•ì¸

yes24.com

#### Third-Party cookie íƒ€ì‚¬ì¿ í‚¤

<img src="https://user-images.githubusercontent.com/81224398/129289024-ff5b31fb-9272-45c4-985f-97d8b5f3f049.png" alt="image" style="zoom: 67%;" />

ê°œë°œìë„êµ¬ë¥¼ ì´ìš©í•´ í™•ì¸í•´ë³´ë©´ yes24í˜ì´ì§€ë¥¼ ë“¤ì–´ê°”ì§€ë§Œ youtubeì˜ ì¿ í‚¤ê°€ ê°™ì´ ëœ¨ëŠ” ê²ƒì„ í™•ì¸ ê°€ëŠ¥

ì™œ? => í˜ì´ì§€ ì–´ë””ì„ ê°€ ìœ íŠœë¸Œì™€ ì—°ê²°ë˜ëŠ” ë§í¬ê°€ ìˆê¸°ë•Œë¬¸ì—



#### ì„¸ì…˜í™•ì¸

<img src="https://user-images.githubusercontent.com/81224398/129290013-067a4402-4a6a-4c3d-b562-4040658ea917.png" alt="image" style="zoom:67%;" />

ì¿ í‚¤ë¥¼ í™•ì¸í•˜ë‹¤ë³´ë©´ ASP.NET_SessionId í•­ëª©ì„ í™•ì¸í•  ìˆ˜ ìˆìŒ

= ë©¤ë²„ì‰½ì¹´ë“œ

cookies = ì§€ê°‘

ì§€ê°‘ ì†ì— ì¿ í‚¤ë„ ìˆê³  ì„¸ì…˜ë„ ìˆëŠ” ê²ƒ

![image](https://user-images.githubusercontent.com/81224398/129293550-f492c989-8fdc-4e9b-a25d-4fd605151dd8.png)

ì„¸ì…˜ì€ ë¸Œë¼ìš°ì €ë¥¼ ì¢…ë£Œí•˜ë©´ ë¦¬ì…‹ë¨

ë¸Œë¼ìš°ì €ë¥¼ ê»ë‹¤ê°€ ë‹¤ì‹œ ì ‘ì† ì‹œ í•´ë‹¹ SessionIdê°€ ë³€ê²½ëœ ê²ƒ í™•ì¸ ê°€ëŠ¥

ì˜ˆì „ì—” ì•ˆì „ì„±ë•Œë¬¸ì— ë§ì´ ì‚¬ìš©í–ˆì§€ë§Œ ì´ë˜ì„œ ì˜ ì‚¬ìš© ì•ˆí•˜ê²Œë˜ëŠ” ê²ƒ

=> ìµœê·¼ì—” ìë™ë¡œê·¸ì¸ (Remember-me) ë°©ì‹ ì‚¬ìš©





ë¡œê·¸ì¸ ì•ˆ í•œ ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸ì‚¬ì´íŠ¸ë¡œ

í•œ ì‚¬ìš©ìëŠ” ê¸°ë³¸ ì›¹í˜ì´ì§€ë¡œ



### Session ì„¸ì…˜ / Cookie ì¿ í‚¤ 

ë‘˜ ë‹¤ ëª©ì ì€ ì ‘ì† ì´ë ¥ì´ ìˆëŠ”ì§€ í™•ì¸í•˜ê¸°ìœ„í•´ì„œ

|   **ë©¤ë²„ì‰½ ì¹´ë“œ**    |                  |      **ìŠ¤íƒ¬í”„ ì¹´ë“œ**       |
| :------------------: | :--------------: | :------------------------: |
|          O           | **ë²ˆí˜¸(ì‹ë³„í‚¤)** |             X              |
|   ê°€ê²Œì—ë§Œ (ì•ˆì „)    |     **ì •ë³´**     |    ë‚˜ì—ê²Œë§Œ(ë¶„ì‹¤/ë³€ì¡°)     |
|     100%ì•ˆì „? No     |                  |    ë³´ê´€ê°€ëŠ¥ (ìœ íš¨ê¸°ê°„)     |
| ë¸Œë¼ìš°ì € ë‹«ìœ¼ë©´ ë¦¬ì…‹ |                  | ìë™ë¡œê·¸ì¸ (*Remember-me*) |
|       **ì„¸ì…˜**       |                  |          **ì¿ í‚¤**          |









#### Session Tracking

DB ì—ì„œë„ ì‚¬ìš©í•¨

jdbc í†µí•´ dbì—°ê²° = *stateless* ë¹„ì—°ê²°ì§€ì†í˜•

workbenchí†µí•´ dbì—°ê²° = *statefull* ì—°ê²°ì§€ì†í˜•



ì„¸ì…˜ => HttpSession / ì¿ í‚¤ => Cookie







### ì„œë²„ì— ì„¸ì…˜ ìš”ì²­

**HttpSessionRequest** (ë¸Œë¼ìš°ì €) => ì„œë²„

`request.getSession` ëª…ë ¹ì–´ í†µí•´ ì„¸ì…˜ ë¶€ì—¬



#### request.getSession( )

- **ìµœì´ˆì ‘ì†** (ì„¸ì…˜ì¿ í‚¤X) => *HttpSession* ì´ìš©

  ```java
  HttpSession session = request.getSession();
  //=> í•´ë‹¹ ëª…ë ¹ì–´ í†µí•´ ê³µê°„ ë§Œë“¤ê³  -> í•´ë‹¹ ê³µê°„ ë¦¬ëª¨ì»¨(ì£¼ì†Œ)ë°˜í™˜
  ```

  

- **ì¬ë°©ë¬¸** (ì„¸ì…˜ì¿ í‚¤O) 





#### set.Attribute

set.Attribute(key, value) 

ê°œì¸ì˜ ì •ë³´ë¥¼ ê³µê°„ì— ë³´ê´€í• ë•Œ? 

```java
session.setAttribute("name", "í™ê¸¸ë™"); 
```

ë³´í†µ DTO DAO í˜•ì‹ìœ¼ë¡œ ì „ì²´ ì •ë³´ ì €ì¥

ì´ ì €ì¥í•˜ëŠ” í–‰ìœ„ ìì²´ê°€ ***ë¡œê·¸ì¸ê³¼ì •***



### ì„¸ì…˜ ì²´í¬

```java
Object obj = session.getAttribute("name");
```

objê°€ nullì´ë¼ë©´?? => í•´ë‹¹ ì‚¬ìš©ìì˜ ì„¸ì…˜ì€ ì—†ëŠ” ê²ƒ ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ì‚¬ìš©ì => ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë³´ë‚´ê¸°

= ë¦¬ë‹¤ì´ë ‰íŠ¸ ì´ìš©



#### redirect





## Logout ë¡œê·¸ì•„ì›ƒ

í˜„ì¬ëŠ” ì„œë²„ì—ì„œ ë‹¤ ë§Œë“¤ì–´ì„œ ë³´ë‚´ë²„ë¦¬ëŠ” -> ì„œë²„ëŠ” ì§€ìš¸ ìˆ˜ ì—†ìŒ

ë¸Œë¼ìš°ì €ì—ì„œëŠ” ê°€ëŠ¥



ë‚´ìš© ì§€ìš°ë©´ ì´ì œ ì •ë³´ ì—†ìœ¼ë‹ˆê°€........





ì„¸ì…˜ë§Œë£Œ

ì„¸ì…˜ìœ íš¨í•˜ì§€ì•ŠìŒ

ì„¸ì…˜ì“°ë ˆë“œìˆœì°½ìŠ¤ë ˆë“œ -> ìœ íš¨í•˜ì§€ì•Šì€ê±° GCì²˜ëŸ¼ ì‚­ì œí•´ë²„ë¦¼

timeout ì„¤ì •í•´ì„œ ì¼ì •ì‹œê°„ ì§€ë‚˜ë©´ ì„¸ì…˜ë§Œë£Œë˜ì–´ ìë™ë¡œê·¸ì•„ì›ƒë˜ë„ë¡ ì„¤ì • ê°€ëŠ¥





----

## ë¡œê·¸ì¸ ë¡œê·¸ì•„ì›ƒ ê°€ëŠ¥í•œ ì„œë²„

### ë¡œê·¸ì¸ í™•ì¸

#### `login.jsp` ìƒì„±

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Login</title>
</head>
<body>
    <h1>Login</h1>

    <form action="fakeLogin.jsp" method="post">
        <input type="text" name="userid">
        <button type="submit">LOGIN</button>
    </form>

</body>
</html>
```





#### `fakeLogin.jsp` ìƒì„±

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Fake Login</title>
</head>
<body>
    <h1>Fake Login</h1>
<%
    String userid = request.getParameter("userid");
    
    //HttpSession session = request.getSession();
    //ì›ë˜ëŠ” ìœ„ì²˜ëŸ¼ í•´ì•¼í•˜ì§€ë§Œ JSPì—ëŠ” ì´ë¯¸ sessionì´ë¼ëŠ” ë³€ìˆ˜ê°€ ìƒì„±ì´ ë˜ì–´ìˆìŒ
    session.setAttribute("name", userid); //=>Object
%>
    <h2><%=userid%>ë‹˜ ë¡œê·¸ì¸ ë˜ì—ˆìŠµë‹ˆë‹¤.</h2>
</body>
</html>
```

login í˜ì´ì§€ì—ì„œ useridë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë°›ì•„ì™€ì„œ sessionì— setAttributeí•´ì„œ ì •ë³´ ì €ì¥

ì €ì¥ë˜ëŠ” ì •ë³´ëŠ” Object í˜•ì‹ìœ¼ë¡œ ì €ì¥ë¨



#### `write.jsp` ìƒì„±

```jsp
<%
  //HttpSession session = request.getAttribute();

  Object obj = session.getAttribute("name");
  //obj=null ì´ë©´ ë¡œê·¸ì¸í˜ì´ì§€ í˜¸ì¶œ

  if (obj == null) {
    response.sendRedirect("/login.jsp");
    //ë¦¬ë‹¤ì´ë ‰íŠ¸ í•´ì£¼ê³  ëë‚´ì•¼í•˜ë‹ˆê¹Œ ê·¸ëƒ¥ ë°”ë¡œ ë¦¬í„´
    return;
  }
%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Write Page</title>
</head>
<body>
  <h1>Write Page</h1>
  <h2><%=obj%></h2>
</body>
</html>
```

fakeLogin í˜ì´ì§€ì—ì„œ objë¥¼ ë°›ì•„ì™€ null ì¸ì§€ ì²´í¬

nullê°’ì´ë¼ë©´ ë¡œê·¸ì¸ì´ ë˜ì§€ ì•Šì•˜ë‹¤ëŠ” ëœ»

obj==null ì¼ë•Œ ë°”ë¡œ ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ì‹œì¼œì¤€ë‹¤



#### ê²°ê³¼

<img src="https://user-images.githubusercontent.com/81224398/129301290-84a0489f-fede-4485-bc33-ddf5cc676966.png" alt="image" style="zoom:67%;" /><img src="https://user-images.githubusercontent.com/81224398/129301307-c71c605d-11b6-44b5-a719-8a7b4613296f.png" alt="image" style="zoom:67%;" /><img src="https://user-images.githubusercontent.com/81224398/129301324-0a4c2efa-86f6-4c96-8608-45d26e14eb5a.png" alt="image" style="zoom:67%;" />



### ë¡œê·¸ì•„ì›ƒ í™•ì¸

#### `logout.jsp` ìƒì„±

```jsp
<%
  //HttpSession session = request.getSession();
  session.removeAttribute("name"); //ë¬´íš¨í™”
  session.invalidate(); //í™•ì‹¤í•œ ì‚­ì œë¥¼ ìœ„í•´
%>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Logout</title>
</head>
<body>
    <h2>LOGOUT</h2>
    <h3>Bye!ğŸ˜œ</h3>
</body>
</html>
```



#### ê²°ê³¼

<img src="https://user-images.githubusercontent.com/81224398/129309498-7f28aa67-ec15-4172-aaab-f02115cabbfd.png" alt="image" style="zoom:67%;" /><img src="https://user-images.githubusercontent.com/81224398/129309214-aadb1c0a-a0a9-4ab8-aea6-7467db8accda.png" alt="image" style="zoom:67%;" />

writeì—ì„œ ë¡œê·¸ì•„ì›ƒì„ ëˆ„ë¥´ë©´ ì„¸ì…˜ì €ì¥ì†Œì— ì €ì¥ëœ ì„¸ì…˜ì´ ì‚¬ë¼ì§€ê³  ë¡œê·¸ì•„ì›ƒë¨







## ìª½ì§€ í”„ë¡œê·¸ë¨ì— ë¡œê·¸ì¸ / ë¡œê·¸ì•„ì›ƒ êµ¬í˜„

### í•„ìš”í•œ ë©¤ë²„ì •ë³´

- **mid** ì‚¬ìš©ì ì•„ì´ë””
- **mpw** ì‚¬ìš©ì ì•”í˜¸
- **mname** ì‚¬ìš©ì ì´ë¦„
- **nickname** ë‹‰ë„¤ì„
- **joindate** ê°€ì…ì¼
- **moddate** ìˆ˜ì •ì¼





### `LoginController` ìƒì„±

```java
//GET - ì•„ì´ë”” íŒ¨ìŠ¤ì›Œë“œ ì…ë ¥
//POST - ë¡œê·¸ì¸ì²˜ë¦¬ -> /msg/list
@Log4j2
@WebServlet(name = "LoginController", value = "/login")
public class LoginController extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        log.info("GET login");

        request.getRequestDispatcher("/WEB-INF/login.jsp").forward(request, response);
    }

    @Override
    protected void doPost(HttpServletRequest request, HttpServletResponse response) throws ServletException, IOException {
        //íŒŒë¼ë¯¸í„° - mid, mpw
        String mid = request.getParameter("mid");
        String mpw = request.getParameter("mpw");

        //ì‚¬ìš©ì ì •ë³´ êµ¬í•˜ê¸° -----> ì •ë³´ ì—†ìœ¼ë©´? -----> ë‹¤ì‹œ GETë°©ì‹ìœ¼ë¡œ ë¡œê·¸ì¸í˜ì´ì§€ê°’
        // ì´ë¦„ë³´ë‹¨ ê°ì²´ Objectë¡œ ë‹´ëŠ”ê²Œ í¸ë¦¬

        //Dummy data
        MemberDTO memberDTO = MemberDTO.builder()
                .mid(mid)
                .mpw(mpw)
                .mname("ì‚¬ìš©ì" + mid)
                .nickname("ì‚¬ìš©ì" + mid)
                .build();

        //ì„¸ì…˜ì— setAttribute("member", ì‚¬ìš©ì ì •ë³´)ë¡œ ì§‘ì–´ë„£ê¸°
        HttpSession session = request.getSession();  //sessionì´ ì—†ìœ¼ë©´ ë§Œë“¤ê³  ìˆìœ¼ë©´ ê°€ì ¸ë‹¤ì”€
        session.setAttribute("member", memberDTO);
    }
}
```



`login.jsp`ì— ë¹„ë°€ë²ˆí˜¸ ì…ë ¥ì°½ ì¶”ê°€

```jsp
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Login</title>
</head>
<body>
    <h1>Login</h1>
    <form action="/login" method="post">
        <input type="text" name="mid"><br>
        <input type="text" name="mpw"><br><br>
        <button type="submit">LOGIN</button>
    </form>
</body>
</html>
```

#### ê²°ê³¼

<img src="https://user-images.githubusercontent.com/81224398/129311032-61162f3c-426d-4525-a092-b1899c47dc7b.png" alt="image" style="zoom:67%;" />![image](https://user-images.githubusercontent.com/81224398/129310873-ea96bbff-bfc4-4259-804e-802c965fde06.png)

ë¡œê·¸ì¸ ì°½ì—ì„œ ë¡œê·¸ì¸ í›„ F12íƒ­ì—ì„œ formdata ë„˜ì–´ì˜¤ëŠ”ê±° í™•ì¸í•˜ê¸°

ê°’ì´ ì œëŒ€ë¡œ ë„˜ì–´ê°”ë‹¤ë©´ write.jspì—ì„œ ì‚¬ìš©ì ì •ë³´ê°€ ì œëŒ€ë¡œ ëœ° ê²ƒ



<img src="https://user-images.githubusercontent.com/81224398/129311119-14b0ae73-3901-458f-a831-fddb884b8146.png" alt="image" style="zoom:67%;" />





### ë¡œê·¸ì¸ ì‹¤íŒ¨ì‹œ ê²½ê³ ë¬¸ ì¶”ê°€

#### `write.jsp` ìˆ˜ì •

```jsp
<%
  Object obj = session.getAttribute("member");
  if (obj == null) {
    response.sendRedirect("/login?result=fail");
    return;
  }
%>
```

ë¡œê·¸ì¸ì„ í•˜ì§€ ì•Šê³  ì§ì ‘ ì ‘ê·¼ ì‹œ ë¦¬ë‹¤ì´ë ‰íŠ¸ê°€ ë˜ë©´ì„œ ë¡œê·¸ì¸ì‚¬ì´íŠ¸ ë§í¬ ë³€ê²½ë¨

http://localhost:8080/login?result=fail

ë’¤ì— ë¶™ì€ ?result=fail ë¥¼ ì¡°ê±´ìœ¼ë¡œ ì„¤ì •í•´ì„œ ê²°ê³¼ë‹¤ë¥´ê²Œ ëœ¨ë„ë¡ ì„¤ê³„



#### `Login.jsp` ìˆ˜ì •

```jsp
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ page contentType="text/html;charset=UTF-8" language="java" %>
<html>
<head>
    <title>Login</title>
</head>
<body>
    <h1>Login</h1>

    <style>
        .warnDiv { color: red; }
    </style>
    <!-- íŠ¹ì • ì¡°ê±´ì¼ ë•Œë§Œ ë³´ì´ê²Œ í•˜ë ¤ë©´? => C íƒœê·¸ì™€ ELì´ìš© -->
    <!-- write.jspë¥¼ ë¡œê·¸ì¸í•˜ì§€ì•Šì€ì±„ë¡œ ì ‘ì† ì‹œ ë‹¤ì‹œ ë¡œê·¸ì¸í˜ì´ì§€ë¡œ ë¦¬ë‹¤ì´ë ‰íŠ¸ ë˜ë©´ì„œ ê²½ê³ ë¬¸êµ¬ê°€ ëœ¨ë„ë¡ -->
    <!-- ì£¼ì†Œì—ì„œ ì¡°ê±´ì„ ì£¼ëŠ” ?ë’¤ì— ë¶™ëŠ” ëª¨ë“  ê²ƒ = param -->
    <c:if test="${param.result != null}">
    <div class="warnDiv">
        <h1>ğŸ™„Login Failed!</h1>
    </div>
    </c:if>

    <form action="/login" method="post">
        <input type="text" name="mid"><br>
        <input type="text" name="mpw"><br><br>
        <button type="submit">LOGIN</button>
    </form>
</body>
</html>
```



#### ê²°ê³¼

ë¡œê·¸ì¸ì„ í•˜ì§€ ì•Šê³  write.jspì— ì ‘ì†í•˜ë ¤ í•  ì‹œì—ë§Œ ì´ëŸ° ê²½ê³ ë¬¸ì´ ëœ¨ë„ë¡ ìˆ˜ì •

<img src="https://user-images.githubusercontent.com/81224398/129312481-88fc062e-f48a-4bc9-95cb-541dac541a88.png" alt="image" style="zoom:67%;" />







registerì— who ê³ ì • = ë³´ë‚´ëŠ”ì‚¬ëŒ = ë¡œê·¸ì¸í•œì‚¬ëŒ



ë¡œê·¸ì¸ ì•ˆí•œ ì‚¬ìš©ìëŠ” ë¡œê·¸ì¸í™”ë©´ìœ¼ë¡œ ë³´ë‚´ê¸°



ë¡œê·¸ì¸ ì‹œ ë°”ë¡œ ë©”ì„¸ì§€ ë¦¬ìŠ¤íŠ¸ë¡œ ì „ì†¡ë˜ë„ë¡ ì—°ê²°







### URL ì„¤ê³„ ìˆ˜ì •

| ê¸°ëŠ¥          | URL           | ì»¨íŠ¸ë¡¤ëŸ¬        | GET/POST           | View (WEB-INF)    | Parameter          | Redirect             |
| ------------- | ------------- | --------------- | ------------------ | ----------------- | ------------------ | -------------------- |
| ë¡œê·¸ì¸ (ì…ë ¥) | /mlogin       | LoginController | GET                | /login.jsp        | -                  |                      |
| ë¡œê·¸ì¸ (ì²˜ë¦¬) | /login        | ``              | POST               | -                 | mid/mpw            | /msg/list            |
| ëª©ë¡ (ë¦¬ìŠ¤íŠ¸) | /msg/list     | GET             | ListController     | /msg/list.jsp     | whom = user1       | -                    |
| ë“±ë¡ (ì…ë ¥)   | /msg/register | GET             | RegisterController | /msg/register.jsp | who = user1        | -                    |
| ë“±ë¡ (ì²˜ë¦¬)   | /msg/register | POST            | -                  | -                 | who, whom, content | /msg/list?whom=user1 |
| ì¡°íšŒ          | /msg/read     | GET             | ReadController     | /msg/read.jsp     | mno=12             | -                    |
| ì‚­ì œ          | /msg/remove   | POST            | RemoveController   | -                 | mno, who           | /msg/list?whom=user1 |

























































